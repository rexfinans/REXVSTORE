<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiriÅŸ Yap / KayÄ±t Ol - RexvStore</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* --- Temel Ayarlar (Koyu Tema) --- */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; /* Slate-900 */ 
            color: #f1f5f9; /* Slate-100 */ 
            overflow: hidden; /* Animasyon iÃ§in scroll barÄ± gizle */
        }

        /* --- Arkaplan Efekti (Cyber Grid) --- */
        .cyber-grid {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: linear-gradient(0deg, transparent 24%, rgba(59, 130, 246, 0.1) 25%, rgba(59, 130, 246, 0.1) 26%, transparent 27%, transparent 74%, rgba(59, 130, 246, 0.1) 75%, rgba(59, 130, 246, 0.1) 76%, transparent 77%, transparent), 
                            linear-gradient(90deg, transparent 24%, rgba(59, 130, 246, 0.1) 25%, rgba(59, 130, 246, 0.1) 26%, transparent 27%, transparent 74%, rgba(59, 130, 246, 0.1) 75%, rgba(59, 130, 246, 0.1) 76%, transparent 77%, transparent);
            background-size: 50px 50px;
            opacity: 0.2;
            z-index: 1;
            animation: grid-scroll 60s linear infinite;
        }

        @keyframes grid-scroll {
            from { background-position: 0 0; }
            to { background-position: 50px 50px; }
        }

        /* --- Form Stili --- */
        .auth-container {
            z-index: 10;
            background: #1e293b; /* Slate-800 */
            border: 1px solid #334155;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }

        .input-field {
            background-color: #0f172a; /* Slate-900 */
            border: 1px solid #334155;
            color: #f1f5f9;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-field:focus {
            border-color: #3b82f6; /* Blue-500 */
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        /* --- Buton GeÃ§iÅŸleri --- */
        .tab-btn {
            transition: all 0.3s;
        }
        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            font-weight: 700;
        }
        
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="cyber-grid"></div>

    <div class="auth-container w-full max-w-md p-8 rounded-xl relative z-20">
        
        <a href="index" class="flex justify-center items-center mb-8 gap-2">
            <i class="fas fa-terminal text-4xl text-red-500"></i>
            <span class="text-3xl font-black" style="background: linear-gradient(135deg, #f87171 0%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                RexvStore
            </span>
        </a>
        <h1 class="text-center text-2xl font-bold text-white mb-6">HesabÄ±nÄ±za EriÅŸin</h1>

        <div class="flex mb-8 bg-slate-700 p-1 rounded-lg">
            <button id="tab-login" onclick="showTab('login')" class="tab-btn active flex-1 py-2 rounded-lg text-sm">GiriÅŸ Yap</button>
            <button id="tab-register" onclick="showTab('register')" class="tab-btn flex-1 py-2 rounded-lg text-sm">KayÄ±t Ol</button>
        </div>

        <form id="form-login" onsubmit="handleLogin(event)" class="space-y-4">
            <div class="relative">
                <i class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
                <input type="email" id="login-email" required placeholder="E-posta Adresiniz" class="input-field w-full pl-12 pr-4 py-3 rounded-lg text-sm">
            </div>
            
            <div class="relative">
                <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
                <input type="password" id="login-password" required placeholder="Åifreniz" class="input-field w-full pl-12 pr-4 py-3 rounded-lg text-sm">
            </div>
            
            <button type="submit" id="btn-login" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg transition duration-200 disabled:opacity-50 flex items-center justify-center">
                <i class="fas fa-sign-in-alt mr-2"></i> GiriÅŸ Yap
            </button>

            <p class="text-center text-sm text-slate-400 pt-2">
                Åifrenizi unuttuysanÄ±z <a href="#" onclick="showForgotPassword()" class="text-blue-500 hover:underline">buraya tÄ±klayÄ±n.</a>
            </p>
        </form>

        <form id="form-register" onsubmit="handleRegister(event)" class="space-y-4" style="display: none;">
            <div class="relative">
                <i class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
                <input type="email" id="register-email" required placeholder="E-posta Adresiniz" class="input-field w-full pl-12 pr-4 py-3 rounded-lg text-sm">
            </div>
            
            <div class="relative">
                <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
                <input type="password" id="register-password" required placeholder="Yeni Åifreniz (Min. 6 Karakter)" class="input-field w-full pl-12 pr-4 py-3 rounded-lg text-sm">
            </div>

            <div class="relative">
                <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
                <input type="password" id="register-password-confirm" required placeholder="Åifreyi Tekrar Girin" class="input-field w-full pl-12 pr-4 py-3 rounded-lg text-sm">
            </div>
            
            <button type="submit" id="btn-register" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-200 disabled:opacity-50 flex items-center justify-center">
                <i class="fas fa-user-plus mr-2"></i> Hesap OluÅŸtur
            </button>

            <p class="text-center text-sm text-slate-400 pt-2">
                KayÄ±t olarak <a href="#" class="text-blue-500 hover:underline">Gizlilik ÅartlarÄ±nÄ±</a> kabul etmiÅŸ olursunuz.
            </p>
        </form>

    </div>

    <script type="module">
        // Firebase ModÃ¼lleri
        // Auth, Firestore, App modÃ¼llerinin hepsi doÄŸru versiyonuyla import edildi.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        
        // ğŸš¨ğŸš¨ğŸš¨ BURAYI KENDÄ° FIREBASE AYARLARINIZLA DOLDURUN ğŸš¨ğŸš¨ğŸš¨
        const firebaseConfig = {
            apiKey: "AIzaSyCR5mseCZP5tWLxzJHMewUTx3ipwIZgNoM", 
            authDomain: "rexvstore.firebaseapp.com",
            projectId: "rexvstore",
            storageBucket: "rexvstore.firebasestorage.app",
            messagingSenderId: "732705231158",
            appId: "1:732705231158:web:ba5ad9c627dcb8ea6ae397",
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app); // ğŸ”¥ Firestore BaÅŸlatÄ±ldÄ±
        
        // --- SAYFA YÃœKLENÄ°RKEN KONTROL ---
        // KullanÄ±cÄ± zaten giriÅŸ yapmÄ±ÅŸsa direkt ana sayfaya yÃ¶nlendir
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("KullanÄ±cÄ± zaten giriÅŸ yapmÄ±ÅŸ, yÃ¶nlendiriliyor.");
                window.location.href = 'index';
            }
        });


        // --- SEKME GEÃ‡Ä°Å Ä°ÅLEVÄ° ---
        window.showTab = (tabName) => {
            const loginForm = document.getElementById('form-login');
            const registerForm = document.getElementById('form-register');
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');

            if (tabName === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
            }
        };

        // --- GÄ°RÄ°Å Ä°ÅLEMÄ° (SIGN IN) ---
        window.handleLogin = async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const btn = document.getElementById('btn-login');

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> GiriÅŸ YapÄ±lÄ±yor...';

            try {
                await signInWithEmailAndPassword(auth, email, password);
                
                Swal.fire({
                    icon: 'success',
                    title: 'BaÅŸarÄ±lÄ±!',
                    text: 'GiriÅŸ baÅŸarÄ±lÄ±. AlÄ±ÅŸveriÅŸe yÃ¶nlendiriliyorsunuz.',
                    timer: 1500,
                    showConfirmButton: false
                }).then(() => {
                    // BaÅŸarÄ±lÄ± giriÅŸten sonra ana sayfaya yÃ¶nlendir
                    window.location.href = 'index';
                });

            } catch (error) {
                console.error("GiriÅŸ HatasÄ±:", error);
                let message = "Beklenmedik bir hata oluÅŸtu.";
                
                // Firebase hata kodlarÄ±na gÃ¶re kullanÄ±cÄ± dostu mesajlar
                if (error.code === 'auth/invalid-email') {
                    message = "GeÃ§ersiz e-posta formatÄ±.";
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    message = "E-posta veya ÅŸifre hatalÄ±. LÃ¼tfen kontrol edin.";
                } else if (error.code === 'auth/too-many-requests') {
                    message = "Ã‡ok fazla baÅŸarÄ±sÄ±z deneme. LÃ¼tfen daha sonra tekrar deneyin.";
                }

                Swal.fire({ icon: 'error', title: 'GiriÅŸ BaÅŸarÄ±sÄ±z', text: message });

            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i> GiriÅŸ Yap';
            }
        };

        // --- KAYIT Ä°ÅLEMÄ° (SIGN UP ve FIRESTORE YAZMA) ---
        window.handleRegister = async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-password-confirm').value;
            const btn = document.getElementById('btn-register');

            if (password !== confirmPassword) {
                Swal.fire({ icon: 'warning', title: 'Hata', text: 'Åifreleriniz birbiriyle eÅŸleÅŸmiyor!' });
                return;
            }
            if (password.length < 6) {
                Swal.fire({ icon: 'warning', title: 'Hata', text: 'Åifreniz en az 6 karakter olmalÄ±dÄ±r.' });
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Hesap OluÅŸturuluyor...';

            try {
                // 1. Authentication'da kullanÄ±cÄ± oluÅŸtur
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // 2. ğŸ”¥ Firestore 'users' koleksiyonuna kaydet (KullanÄ±cÄ±nÄ±n UID'si DÃ¶kÃ¼man ID'si olarak kullanÄ±ldÄ±)
                await setDoc(doc(db, "users", user.uid), {
                    email: user.email,
                    uid: user.uid,
                    createdAt: new Date(),
                    role: "customer" 
                });

                Swal.fire({
                    icon: 'success',
                    title: 'KayÄ±t BaÅŸarÄ±lÄ±!',
                    text: 'HesabÄ±nÄ±z oluÅŸturuldu ve veritabanÄ±na kaydedildi. YÃ¶nlendiriliyorsunuz...',
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    // BaÅŸarÄ±lÄ± kayÄ±ttan sonra ana sayfaya yÃ¶nlendir
                    window.location.href = 'index';
                });

            } catch (error) {
                console.error("KayÄ±t HatasÄ±:", error);
                let message = "Beklenmedik bir hata oluÅŸtu.";
                
                if (error.code === 'auth/email-already-in-use') {
                    message = "Bu e-posta adresi zaten kullanÄ±mda.";
                } else if (error.code === 'auth/invalid-email') {
                    message = "GeÃ§ersiz e-posta formatÄ±.";
                }

                Swal.fire({ icon: 'error', title: 'KayÄ±t BaÅŸarÄ±sÄ±z', text: message });

            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-user-plus mr-2"></i> Hesap OluÅŸtur';
            }
        };
        
        // --- ÅÄ°FRE SIFIRLAMA ---
        window.showForgotPassword = async () => {
            const { value: email } = await Swal.fire({
                title: 'Åifre SÄ±fÄ±rlama',
                input: 'email',
                inputLabel: 'Åifrenizi sÄ±fÄ±rlamak iÃ§in e-posta adresinizi girin',
                inputPlaceholder: 'E-posta adresi...',
                showCancelButton: true,
                confirmButtonText: 'SÄ±fÄ±rlama Linki GÃ¶nder'
            });

            if (email) {
                 try {
                    await sendPasswordResetEmail(auth, email);
                    Swal.fire({ 
                        icon: 'info', 
                        title: 'E-posta GÃ¶nderildi', 
                        text: `${email} adresinize ÅŸifre sÄ±fÄ±rlama linki gÃ¶nderildi. LÃ¼tfen gelen kutunuzu kontrol edin.` 
                    });
                } catch (error) {
                    console.error("Åifre SÄ±fÄ±rlama HatasÄ±:", error);
                    let message = "E-posta gÃ¶nderilemedi. E-posta adresinin doÄŸru olduÄŸundan emin olun.";
                    if (error.code === 'auth/user-not-found') {
                        message = "Bu e-posta adresine kayÄ±tlÄ± bir kullanÄ±cÄ± bulunamadÄ±.";
                    }
                     Swal.fire({ icon: 'error', title: 'Hata', text: message });
                }
            }
        };

        // Sayfa yÃ¼klendiÄŸinde GiriÅŸ sekmesini varsayÄ±lan olarak gÃ¶ster
        window.showTab('login');
    </script>
</body>
</html>
