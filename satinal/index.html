<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sipari≈üi Tamamla - RexvStore</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .checkout-container { max-width: 1024px; } 
        /* Girdi ve Buton odaklanma efekti */
        input:focus, textarea:focus, select:focus {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 1px rgba(220, 38, 38, 0.5) !important;
            outline: none;
        }
        .payment-tab.active {
            border-color: #dc2626;
            background-color: #fee2e2; /* Red 100 */
        }
    </style>
</head>
<body class="p-4 sm:p-6">

<div class="checkout-container mx-auto">
    <div class="flex items-center mb-6">
        <a href="index.html" class="text-red-600 hover:text-red-700 transition mr-4">
            <i class="fas fa-chevron-left text-xl"></i>
        </a>
        <h1 class="text-3xl font-bold text-gray-800">Sipari≈üi Tamamla</h1>
    </div>

    <div id="loading-spinner" class="text-center py-10" style="display: none;">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-red-500 border-t-transparent mx-auto mb-3"></div>
        <p class="text-gray-600 font-medium">Veriler y√ºkleniyor...</p>
    </div>

    <div id="empty-cart" class="bg-white p-8 rounded-xl shadow-lg text-center" style="display: none;">
        <i class="fas fa-shopping-basket text-6xl text-gray-300 mb-4"></i>
        <h2 class="text-xl font-semibold mb-2">Sepetiniz Bo≈ü G√∂r√ºn√ºyor!</h2>
        <a href="index.html" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md">
            √úr√ºnlere Geri D√∂n
        </a>
    </div>

    <div id="checkout-content" class="lg:grid lg:grid-cols-3 lg:gap-8" style="display: none;">
        
        <div class="lg:col-span-2 space-y-6">

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-800">1. ƒ∞leti≈üim Bilgileri</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="customer-name" class="block text-sm font-medium text-gray-700">Adƒ±nƒ±z Soyadƒ±nƒ±z *</label>
                        <input type="text" id="customer-name" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3" placeholder="√ñrn: Can Yƒ±lmaz">
                    </div>
                    <div>
                        <label for="customer-email" class="block text-sm font-medium text-gray-700">E-posta Adresiniz * (Fatura ve Bilgiler Buraya G√∂nderilecektir)</label>
                        <input type="email" id="customer-email" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3" placeholder="mail@ornek.com">
                    </div>
                    <div>
                        <label for="customer-phone" class="block text-sm font-medium text-gray-700">Telefon Numaranƒ±z *</label>
                        <input type="text" id="customer-phone" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3" placeholder="√ñrn: 500 123 45 67">
                    </div>
                    <div>
                        <label for="order-notes" class="block text-sm font-medium text-gray-700">Sipari≈ü Notu (Opsiyonel)</label>
                        <textarea id="order-notes" rows="2" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3"></textarea>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-800">2. √ñdeme Y√∂ntemi Se√ßin</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <button type="button" data-tab="eft" class="payment-tab active p-4 border-2 border-red-600 rounded-lg font-semibold text-gray-800 hover:bg-gray-100 transition">
                        <i class="fas fa-university mr-2 text-red-600"></i> EFT / Havale
                    </button>
                    <button type="button" data-tab="usdt" class="payment-tab p-4 border-2 border-gray-200 rounded-lg font-semibold text-gray-800 hover:bg-gray-100 transition">
                        <i class="fas fa-bitcoin mr-2 text-green-600"></i> Kripto (USDT TRC20)
                    </button>
                    <button type="button" data-tab="credit" class="payment-tab p-4 border-2 border-gray-200 rounded-lg font-semibold text-gray-800 hover:bg-gray-100 transition">
                        <i class="fas fa-credit-card mr-2 text-blue-600"></i> Kart / Kredi Kartƒ±
                    </button>
                </div>

                <div id="payment-details-content" class="space-y-6">
                    
                    <div id="payment-eft" data-content>
                        <h3 class="text-lg font-semibold mb-3 text-gray-700">Banka Bilgileri</h3>
                        <div class="space-y-3 p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>Hesap Sahibi:</span>
                                <span id="bank-name-display" class="font-bold text-gray-900">√ñRNEK Tƒ∞CARET VE YAZILIM A.≈û.</span>
                            </div>
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>IBAN (Kopyala):</span>
                                <span id="bank-iban-display" class="font-bold text-red-600 cursor-pointer hover:underline" onclick="copyToClipboard('bank-iban-display')">
                                    TR55 0000 1111 2222 3333 4444 55
                                </span>
                            </div>
                            <p class="text-xs text-red-700 pt-2 border-t border-red-100">
                                <i class="fas fa-info-circle mr-1"></i> A√ßƒ±klama kƒ±smƒ±na sadece Adƒ±nƒ±zƒ± Soyadƒ±nƒ±zƒ± yazƒ±nƒ±z.
                            </p>
                        </div>
                    </div>
                    
                    <div id="payment-usdt" data-content style="display: none;">
                        <h3 class="text-lg font-semibold mb-3 text-gray-700">Kripto Para Bilgileri (TRC20 Aƒüƒ±)</h3>
                        <div class="space-y-3 p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>G√∂nderilecek Miktar (USDT):</span>
                                <span id="usdt-amount-display" class="font-bold text-green-600 text-lg cursor-pointer hover:underline" onclick="copyToClipboard('usdt-amount-display')">
                                    <i class="fas fa-spinner fa-spin mr-1"></i> Hesaplama...
                                </span>
                            </div>
                            <div class="flex justify-between items-center text-sm font-medium text-gray-700">
                                <span>TRC20 C√ºzdan Adresi (Kopyala):</span>
                                <span id="usdt-address-display" class="font-bold text-gray-900 cursor-pointer hover:underline" onclick="copyToClipboard('usdt-address-display')">
                                    TRC20_ADRESƒ∞_BURAYA_GELMELƒ∞_ORNEK_AƒûTRON
                                </span>
                            </div>
                            <p class="text-xs text-green-700 pt-2 border-t border-green-100">
                                <i class="fas fa-exclamation-triangle mr-1"></i> L√ºtfen yalnƒ±zca USDT (TRC20) g√∂nderin ve doƒüru aƒüƒ± se√ßtiƒüinizden emin olun!
                            </p>
                        </div>
                    </div>

                    <div id="payment-credit" data-content style="display: none;">
                        <div class="p-6 bg-blue-50 border border-blue-200 rounded-lg text-center">
                            <h3 class="text-xl font-bold text-blue-700 mb-2">3D G√ºvenli √ñdeme</h3>
                            <p class="text-gray-600 mb-4">Kart ile √∂deme i√ßin G√ºvenli √ñdeme √á√∂z√ºm√º (Iyzico/PayTR/Shopier) entegrasyonuna y√∂nlendirileceksiniz.</p>
                            <button type="button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 disabled:bg-blue-400" disabled>
                                <i class="fas fa-external-link-alt mr-2"></i> G√ºvenli √ñdeme Ekranƒ±na Git (Sim√ºlasyon)
                            </button>
                            <p class="text-xs text-blue-700 mt-2">Kart ile √∂deme bu sim√ºlasyonda aktif deƒüildir.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-800">3. √ñdemeyi Bildir ve Sipari≈üi Tamamla</h2>
                
                <form id="checkout-form" onsubmit="processOrder(event)">
                    <input type="hidden" id="selected-payment-method" value="EFT/Havale">
                    
                    <div id="receipt-upload-section">
                        <label for="receipt-file" class="block text-sm font-medium text-gray-700 mb-2">√ñdeme Dekontu Y√ºkle *</label>
                        <input type="file" id="receipt-file" required accept="image/*,application/pdf" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100">
                        <p class="text-xs text-gray-500 mt-1">L√ºtfen √∂deme yaptƒ±ƒüƒ±nƒ±za dair dekontu y√ºkleyin (.jpg, .png veya .pdf)</p>
                    </div>

                    <div class="mt-6 flex items-start">
                        <input type="checkbox" id="terms-accepted" required class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500 mt-1">
                        <label for="terms-accepted" class="ml-3 text-sm font-medium text-gray-900">
                            <a href="#" class="text-red-600 hover:underline">≈ûartlar ve Ko≈üullarƒ±</a> okudum ve kabul ediyorum. *
                        </label>
                    </div>

                    <button type="submit" id="complete-order-btn" class="mt-6 w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 shadow-xl text-lg disabled:bg-red-400">
                        <i class="fas fa-check-circle mr-2"></i> √ñdemeyi Bildir ve √úr√ºn√º Al
                    </button>
                </form>
            </div>
            
        </div>

        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg sticky top-6 self-start h-min">
            <h2 class="text-xl font-bold mb-4 border-b pb-2 text-gray-800">Sipari≈ü √ñzeti üõçÔ∏è</h2>
            
            <div id="cart-summary-list" class="space-y-4 border-b pb-4 mb-4">
                </div>

            <div class="space-y-2 text-gray-700">
                <div class="flex justify-between font-medium">
                    <span>Ara Toplam</span>
                    <span id="subtotal-display">0.00 TL</span>
                </div>
                <div class="flex justify-between text-sm text-green-600">
                    <span>ƒ∞ndirim</span>
                    <span id="discount-display">- 0.00 TL</span>
                </div>
                <div class="flex justify-between font-bold text-lg pt-2 border-t border-gray-200 text-gray-900">
                    <span>Genel Toplam</span>
                    <span id="total-display">0.00 TL</span>
                </div>
                <p id="total-usdt-info" class="text-sm text-gray-500 italic text-right mt-1 pt-1 border-t border-dashed" style="display: none;"></p>
            </div>
            
            <button onclick="window.location.href='index.html'" class="w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 rounded-lg transition duration-200 text-sm">
                <i class="fas fa-pencil-alt mr-2"></i> Sepeti D√ºzenle
            </button>
        </div>

    </div>
</div>

<script type="module">
    // üî• Firebase Mod√ºlleri
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, query, where, addDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";
    
    // --- 1. GLOBAL DEƒûƒ∞≈ûKENLER VE AYARLAR ---
    let app, db, auth, storage;
    let productsData = []; 
    let cartItems = [];    
    let totalDiscount = 0;
    let finalTotalTL = 0;
    const USDT_EXCHANGE_RATE = 32.5; // √ñrnek TL/USDT kuru (Bunu dinamik √ßekmeniz √∂nerilir!)
    
    // üö®üö®üö® BURAYI KENDƒ∞ FIREBASE AYARLARINIZLA DOLDURUN üö®üö®üö®
    const firebaseConfig = {
        apiKey: "AIzaSyCR5mseCZP5tWLxzJHMewUTx3ipwIZgNoM", 
        authDomain: "rexvstore.firebaseapp.com",
        projectId: "rexvstore",
        storageBucket: "rexvstore.appspot.com", // storageBucket alanƒ±nƒ± doldurun!
        messagingSenderId: "732705231158",
        appId: "1:732705231158:web:ba5ad9c627dcb8ea6ae397",
    };
    
    const APP_ID_PATH = 'rexvstore-main'; 
    const PUBLIC_DATA_ROOT = `artifacts/${APP_ID_PATH}/public/data`;
    const PRODUCTS_PATH = () => `${PUBLIC_DATA_ROOT}/products`; 
    const ORDERS_PATH = 'orders'; 

    // --- 2. FIREBASE BA≈ûLATMA & VERƒ∞ √áEKME ---
    async function initFirebase() {
        document.getElementById('loading-spinner').style.display = 'block';
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            storage = getStorage(app); // Storage'ƒ± ba≈ülat
            
            await signInAnonymously(auth);
            
            cartItems = JSON.parse(localStorage.getItem('cart')) || [];
            
            if (cartItems.length === 0) {
                showEmptyCart();
                return;
            }

            const productIds = cartItems.map(item => item.id);
            if (productIds.length > 0) {
                const productsRef = collection(db, PRODUCTS_PATH());
                const q = query(productsRef, where("__name__", "in", productIds));
                const snapshot = await getDocs(q);
                
                productsData = snapshot.docs.map(doc => ({ 
                    id: doc.id, 
                    ...doc.data() 
                }));
            }

            renderCartSummary();

        } catch (error) {
            console.error("üî• HATA: Veri Y√ºklenirken Hata Olu≈ütu:", error);
            Swal.fire('Hata', '√úr√ºn verileri y√ºklenirken bir sorun olu≈ütu. Konsolu kontrol edin.', 'error');
            showEmptyCart(); 
        } finally {
            document.getElementById('loading-spinner').style.display = 'none';
        }
    }
    
    // --- 3. RENDER FONKSƒ∞YONLARI ---

    function showEmptyCart() {
        document.getElementById('empty-cart').style.display = 'block';
        document.getElementById('checkout-content').style.display = 'none';
    }

    function renderCartSummary() {
        const summaryDiv = document.getElementById('cart-summary-list');
        let subtotal = 0;
        let discount = 0;
        
        if (cartItems.length === 0) {
            showEmptyCart();
            return;
        }

        const summaryHtml = cartItems.map(cartItem => {
            const product = productsData.find(p => p.id === cartItem.id);
            if (!product) return ''; 

            const unitPrice = product.price || 0;
            const discountedPrice = product.discounted_price || unitPrice;
            const totalItemPrice = discountedPrice * cartItem.quantity;
            const itemDiscount = (unitPrice - discountedPrice) * cartItem.quantity;

            subtotal += unitPrice * cartItem.quantity; 
            discount += itemDiscount;
            
            return `
                <div class="flex items-start justify-between">
                    <div class="flex-1 pr-4">
                        <p class="font-medium text-gray-900">${product.name_tr || product.name}</p>
                        <p class="text-xs text-gray-500">${cartItem.quantity} adet x ${discountedPrice.toLocaleString('tr-TR')} TL</p>
                    </div>
                    <span class="font-semibold text-gray-800 flex-shrink-0">
                        ${totalItemPrice.toLocaleString('tr-TR')} TL
                    </span>
                </div>
            `;
        }).join('');

        finalTotalTL = subtotal - discount;
        totalDiscount = discount;
        const finalTotalUSDT = (finalTotalTL / USDT_EXCHANGE_RATE).toFixed(2);

        summaryDiv.innerHTML = summaryHtml;
        document.getElementById('subtotal-display').textContent = subtotal.toLocaleString('tr-TR') + ' TL';
        document.getElementById('discount-display').textContent = '- ' + totalDiscount.toLocaleString('tr-TR') + ' TL';
        document.getElementById('total-display').textContent = finalTotalTL.toLocaleString('tr-TR') + ' TL';
        
        // USDT Bilgilerini G√ºncelle
        document.getElementById('usdt-amount-display').textContent = `${finalTotalUSDT} USDT`;
        document.getElementById('total-usdt-info').textContent = `(Yakla≈üƒ±k ${finalTotalUSDT} USDT)`;

        document.getElementById('checkout-content').style.display = 'grid';
        document.getElementById('total-usdt-info').style.display = 'block';
    }

    // --- 4. √ñDEME Y√ñNTEMƒ∞ Y√ñNETƒ∞Mƒ∞ ---

    document.querySelectorAll('.payment-tab').forEach(button => {
        button.addEventListener('click', function() {
            const selectedTab = this.getAttribute('data-tab');
            
            // Sekme Stillerini G√ºncelle
            document.querySelectorAll('.payment-tab').forEach(btn => {
                btn.classList.remove('active', 'border-red-600', 'bg-red-50');
                btn.classList.add('border-gray-200');
            });
            this.classList.add('active', 'border-red-600', 'bg-red-50');
            this.classList.remove('border-gray-200');

            // ƒ∞√ßerikleri Gizle/G√∂ster
            document.querySelectorAll('[data-content]').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`payment-${selectedTab}`).style.display = 'block';
            
            // Hidden input'u ve Dekont alanƒ±nƒ± g√ºncelle
            document.getElementById('selected-payment-method').value = selectedTab.toUpperCase();
            
            const receiptSection = document.getElementById('receipt-upload-section');
            const receiptFile = document.getElementById('receipt-file');

            // Kart √∂demesi se√ßildiƒüinde dekont y√ºkleme zorunluƒüunu kaldƒ±r
            if (selectedTab === 'credit') {
                receiptSection.style.display = 'none';
                receiptFile.removeAttribute('required');
                document.getElementById('complete-order-btn').innerHTML = '<i class="fas fa-external-link-alt mr-2"></i> G√ºvenli √ñdeme Ekranƒ±na Y√∂nlen';
            } else {
                receiptSection.style.display = 'block';
                receiptFile.setAttribute('required', 'required');
                document.getElementById('complete-order-btn').innerHTML = '<i class="fas fa-check-circle mr-2"></i> √ñdemeyi Bildir ve √úr√ºn√º Al';
            }
        });
    });
    
    // --- 5. KOPYALAMA ƒ∞≈ûLEMƒ∞ ---

    window.copyToClipboard = function(elementId) {
        const textToCopy = document.getElementById(elementId).textContent.trim().replace(/\s/g, ''); // Bo≈üluklarƒ± kaldƒ±r
        navigator.clipboard.writeText(textToCopy).then(() => {
            Swal.fire({
                icon: 'success',
                title: 'Kopyalandƒ±!',
                text: textToCopy,
                showConfirmButton: false,
                timer: 1000
            });
        }).catch(err => {
            console.error('Kopyalama hatasƒ±: ', err);
        });
    };

    // --- 6. Sƒ∞PARƒ∞≈û ƒ∞≈ûLEME FONKSƒ∞YONU ---

    window.processOrder = async function(event) {
        event.preventDefault();
        
        const paymentMethod = document.getElementById('selected-payment-method').value;

        // Kart se√ßildiyse y√∂nlendirme sim√ºlasyonu yap
        if (paymentMethod === 'CREDIT') {
            await Swal.fire('Y√∂nlendiriliyorsunuz...', 'Kart √∂deme ekranƒ± sim√ºlasyonu. Ger√ßek entegrasyon i√ßin bir √∂deme API kullanmalƒ±sƒ±nƒ±z.', 'info');
            return;
        }

        const receiptFile = document.getElementById('receipt-file').files[0];
        if (!receiptFile) {
            Swal.fire('Hata!', '√ñdemenizi tamamlamak i√ßin dekont y√ºklemelisiniz.', 'error');
            return;
        }

        const btn = document.getElementById('complete-order-btn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Sipari≈ü Olu≈üturuluyor...';
        
        try {
            // 1. Dekontu Firebase Storage'a y√ºkle
            const receiptPath = `receipts/${auth.currentUser.uid}/${Date.now()}_${receiptFile.name}`;
            const storageRef = ref(storage, receiptPath);
            const uploadResult = await uploadBytes(storageRef, receiptFile);
            const receiptURL = await getDownloadURL(uploadResult.ref);

            // 2. Form verilerini topla
            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const orderNotes = document.getElementById('order-notes').value;
            
            // 3. Sipari≈ü detaylarƒ±nƒ± hazƒ±rla
            const orderDetails = cartItems.map(item => {
                const product = productsData.find(p => p.id === item.id);
                return {
                    productId: item.id,
                    productName: product?.name_tr || product?.name || 'Bilinmeyen √úr√ºn',
                    quantity: item.quantity,
                    finalPrice: product?.discounted_price || product?.price || 0,
                };
            });

            // 4. Firestore'a kaydedilecek ana veri yapƒ±sƒ±
            const orderData = {
                customer: {
                    name: customerName,
                    email: customerEmail,
                    phone: customerPhone,
                },
                items: orderDetails,
                totalTL: finalTotalTL,
                totalUSDT: (finalTotalTL / USDT_EXCHANGE_RATE).toFixed(2),
                paymentMethod: paymentMethod,
                receiptURL: receiptURL, // Dekont URL'sini kaydet
                status: 'Beklemede (√ñdeme Bildirildi)', 
                createdAt: new Date(),
                userId: auth.currentUser ? auth.currentUser.uid : 'Anonim', 
            };

            // 5. Firebase Firestore'a kaydetme
            const docRef = await addDoc(collection(db, ORDERS_PATH), orderData);

            // 6. Ba≈üarƒ±lƒ± olursa: Sepeti Temizle ve Onay Mesajƒ± G√∂ster
            localStorage.removeItem('cart');
            
            await Swal.fire({
                title: 'üéâ Sipari≈üiniz Ba≈üarƒ±yla Alƒ±ndƒ±!',
                html: `
                    <p class="text-base text-gray-700 mb-3">Sipari≈ü Numaranƒ±z: <b>#${docRef.id.substring(0, 8).toUpperCase()}</b></p>
                    <p class="text-sm text-gray-600">√ñdemenizi bildirdiƒüiniz i√ßin te≈üekk√ºr ederiz. Ekibimiz en kƒ±sa s√ºrede <b>${customerEmail}</b> adresinize faturanƒ±z ve √ºr√ºn√ºn√ºzle ilgili bilgileri g√∂nderecektir. L√ºtfen e-postanƒ±zƒ± kontrol edin.</p>
                `,
                icon: 'success',
                confirmButtonText: 'Ana Sayfaya D√∂n',
                allowOutsideClick: false,
                allowEscapeKey: false
            });

            // 7. Ana sayfaya y√∂nlendir
            window.location.href = 'index';

        } catch (error) {
            console.error("üî• Sƒ∞PARƒ∞≈û OLU≈ûTURMA HATASI:", error);
            Swal.fire('Hata!', 'Sipari≈üiniz olu≈üturulamadƒ±. L√ºtfen tekrar deneyin. Detay: ' + error.message, 'error');
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-check-circle mr-2"></i> √ñdemeyi Bildir ve √úr√ºn√º Al';
        }
    }

    // Uygulama Ba≈ülatma
    window.onload = initFirebase;
    
</script>
</body>
</html>
